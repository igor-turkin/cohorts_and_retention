В файлe retention_function.ipynb находится функция для питона для проведения когортного анализа и расчета retention.

Имеется датафрейм с тремя столбцами: id пользователя, дата регистрации пользователя, дата авторизации пользователя.

При вызове функции нужно указать названия датафрейма и задать временной период (ОТ и ДО) по которому будут построенны когорты. Временные период должен находится в границах дат имеющихся в датафрейма, для чего перед функций производится поиск минимальной и максимальной даты.

Принцип работы функции:
1. Отфильтровываются лишние строки не входящие в нужный временной период
2. Для каждой авторизации расчитывается разница между днем авторизации и днем регистрации. В дальнейшем это будет использоваться как количество дней после создания когорты
3. С помощью группировки (по дням регистрации) для каждой когорты расчитывается количество пользователей в день регистрации и последующии дни. Когорта = день регистрации.
4. Для расчета retention понадобится знать первоначальный размер каждой когорты, поэтому количество пользователей нулевого дня выносится в отдельный столбец
5. Рассчитывается retention (размер когорты делится на количество пользователей в последующие дни)
6. Строится сводная таблица и визуализация.

Таким образом в таблице будут содержаться следующие столбцы: id пользователеля, день регистрации (он же название когорты), день авторизации, порядовый номер дня после регистрации, количество пользователей в день создания когорты, количество пользователей когорты в день авторизации

В файле cohort_analysis.ipynb находится пошаговый разбор построения когортного анализа, retention rate и разбор нескольких возможноных сложностей

Имеется датафрейм с покупками интернет-магазина
Инструкция:
0. Отфильтровываю строки по нужному временному периоду, и определяю временную форму для когорт (тут это месяцы)
1. Оставляю только 2 столбца из таблицы: id клиента и дата активности
2. Объединяю клиентов в когорты по дате (месяцу) первой активности 
3. Считаю количество клиентов в каждой когорте
4. Считаю количество клиентов из каждой когорты в последующие месяцы
5. Удаляю лишние дубликаты, когда у клиента больше чем 1 активности за период
6. Расчитываю retention rate
7. Расчитываю количество месяцев с образования когорт
8. Строю сводную таблицу
9. Строю визуализацию

Так же рассматривается решение ситуаций когда сводная таблица была построенна в абсолютном виде значений без расчета retention rate и месяцев c обзразования когорт

В файле cohorts.sql находится код sql для построения когортного анализа. Функции для построения сводной таблицы в моем Posstgresql нету, поэтому сводная таблица строится уже сторонними методами визуализации.

Принцип работы кода:
1. Из датафрейма беру столбцы: уникальные пользователи, дата активности, и через оконную функцию нахожу минимальную дату активности, которая становится когортой пользователя
2. В основном запросе группирую по дате активности и когорте
3. Вывожу столбцы с датой активности и когортами, считаю количество уникальных пользователей для каждой когорты по дням, из этого количества через оконную функцию нахожу максимальное для каждой когорты, это будет размер когорты, считаю ретеншен, высчитываю дни после образования когорт
4. Строится сводная таблица
 